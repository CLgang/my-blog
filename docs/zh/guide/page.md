---
# 这是页面的图标
icon: page
# 这是文章的标题
title: 前端为什么要关注内存
# 设置作者
author: 陈俊刚
# 设置写作时间
time: 2021-07-01
# 一个页面只能有一个分类
category: JavaScript
# 一个页面可以有多个标签
tag:
  - 内存
# 此页面会在文章列表指定
sticky: true
# 此页面会出现在首页的文章板块中
star: true
# 你可以自定义页脚
footer:
---

## 为什么需要关注内存

- 防止页面占用内存过大，引起客户端卡顿，甚至无响应
- Node.js使用V8引擎，内存对于后端服务的性能至关重要，因为后端服务的持久性，后端更容易造成内存溢出。

## 数据类型

- 原始数据类型：字符串（String）、数字（Number）、布尔（Boolean）、空对象（Null）、未定义（Undefined）、Symbol
- 引用数据类型：Object
- 内存空间：栈内存（stack）、堆内存（heap）

## 垃圾回收

JavaScript引擎找出那些不在继续使用的变量，然后释放其所占用的内存，垃圾回收器会按照固定的时间间隔周期性地执行这一操作。

JavaScript使用垃圾回收机制来自动管理内存，这个机制是一把双刃剑：

- 优势： 可以大幅简化程序的内存管理代码，减低程序员的负担，减少因长时间运转而带来的内存泄露问题。
- 不足： 意味着程序员将无法掌控内存。JavaScript没有暴露任何关于内存的API。我们无法强迫其进行垃圾回收，更无法干预内存管理。

## 引用计数

- 引用计数
    跟踪记录每个值被引用的次数，如果一个值的引用次数是0，就表示这个值不再用到了，因此可以将这块内存释放。
- 原理
    每次引用加1，被释放时减1，当这个值的引用次数变成0时，就可以将其内存空间回收。

## 标记清除

- 标记清除指的是当变量进入环境时，这个变量标记为“进入环境”；而当变量离开环境时，则将其标记为“离开环境”。
最后，垃圾回收器完成内存清除工作，销毁并回收那些被标记为“离开环境”的值所占用的内存空间

- 执行环境定义了变量或函数有权访问的其他数据，决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。
    - 全局执行环境是最外围的一个执行环境。根据ECMAScript实现所在的宿主环境不同，表示执行环境的变量对象也不一样。
  例如，在WEB浏览器中，与全局执行环境关联的变量对象是Window对象，而在Node中，全局执行环境是Global对象。
    - 每个函数都有自己的执行环境。当执行流进入一个函数时，函数的环境就会被推入一个环境栈中。而在函数执行之后，栈将其环境弹出，把控制权返回给之前的执行环境。
  ECMAScript程序中的执行流正是由这个方便的机制控制着。

```javascript
function foo () {
    var a = 10; // 被标记进入环境
    var b = 'hello'; // 被标记进入环境
}
foo (); // 执行完毕，a 和 b被标记离开环境，内存被回收
```

## V8内存管理机制

::: tip
  限制内存的原因
  - V8最初为浏览器而设计，不太可能遇到大量内存的使用场景。
  - 防止因为垃圾回收所导致的线程暂停执行的时间过长。
:::

#### V8的回收策略

- V8采用了一种分代回收的策略，将内存分为两个生代：新生代和老生代。
- V8分别对新生代和老生代使用不同的垃圾回收算法来提升垃圾回收的效率。

